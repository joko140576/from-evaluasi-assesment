<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Form Hasil Assessment Level Manager</title>
  <style>
    :root{--accent:#1f6feb;--card:#ffffff;--muted:#666}
    body{font-family:Inter, system-ui, Arial; background:#f4f6fb; margin:20px}
    .container{max-width:1000px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(20,30,60,0.06)}
    header{display:flex;gap:18px;align-items:flex-start;margin-bottom:12px}
    .logo-frame{width:150px;height:150px;border:2px dashed #d0d7e6;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;background:#fff}
    .logo-frame img{width:100%;height:100%;object-fit:cover}
    h1{font-size:18px;margin:0}
    form .section{margin-top:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-weight:600;margin-bottom:6px;font-size:13px}
    input[type=text], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #d7dee9;font-size:14px}
    textarea{min-height:80px;resize:vertical}
    .rating-row{display:grid;grid-template-columns:repeat(6,1fr);gap:6px;align-items:center}
    .rating-row .label{grid-column:1/span 1;font-weight:600;font-size:13px}
    .rating-row .controls{grid-column:2/span 5;display:flex;gap:6px}
    .rating-row select{flex:1;max-width:160px}
    .full{grid-column:1/span 2}
    .buttons{display:flex;gap:8px;justify-content:flex-end;margin-top:16px}
    .btn{padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}
    .btn.secondary{background:#6b7280}
    .btn.danger {background: darkred;}
    .btn.primary {background: darkblue;}
    .btn.success {background: seagreen;}
    .tanggal-besar {font-size: 16px;padding: 10px 14px;border-radius: 10px;border: 1px solid var(--accent);background: #f9fbff}
    .note-box{border: 1px dashed rgba(31,111,235,0.25);background: #f9fbff;padding: 10px 12px;border-radius: 10px;font-size: 14px;margin:8px 0}
    @media print{.no-print{display:none}.card{box-shadow:none;border-radius:0;padding:6mm}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="formCard">
      <header>
        <div>
          <div class="logo-frame" id="photoFrame">
            <span style="color:#99a0b3;text-align:center;padding:8px">Foto Pelamar<br />(klik untuk pilih)</span>
          </div>
          <div style="margin-top:8px">
            <label>Nama Asesi</label>
            <input type="text" id="nama_asesi" placeholder="Isi nama asesi" required />
          </div>
        </div>
        <div style="flex:1">
          <h1>FORM EVALUASI ASSESSMENT LEVEL MANAGER</h1>
        </div>
      </header>

      <form id="formInterview">
        <!-- upload -->
        <div style="display:flex;gap:8px;margin-bottom:12px" class="no-print">
          <input type="file" id="photoInput" accept="image/*" style="display:none" />
          <button type="button" class="btn primary" onclick="document.getElementById('photoInput').click()">Pilih Foto</button>
          <button type="button" class="btn danger" onclick="clearPhoto()">Hapus Foto</button>
        </div>

        <!-- tanggal -->
        <div class="section">
          <h3>Tanggal Assessment</h3>
          <div class="grid">
            <div>
              <label>Tanggal Assessment</label>
              <input type="date" id="tanggal_wawancara" class="tanggal-besar" required />
            </div>
            <div>
              <label>Nama Asesor / Penguji</label>
              <input type="text" id="nama_pewawancara" placeholder="Isi nama pewawancara" required />
            </div>
          </div>
        </div>

        <!-- personal -->
        <div class="section">
          <h3>2. Evaluasi Kompetensi (Personal)</h3>
          <div class="note-box">1 = Sangat kurang, 5 = Sangat baik</div>
          <div class="grid">
            <div class="rating-row">
              <div class="label">Customer Fokus</div>
              <div class="controls"><select id="personal_customer"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Driving Execution</div>
              <div class="controls"><select id="personal_driving"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Developing Org Capabilities</div>
              <div class="controls"><select id="personal_developing"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Managing Diversity</div>
              <div class="controls"><select id="personal_diversity"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
          </div>
        </div>

        <!-- team -->
        <div class="section">
          <h3>3. Evaluasi Kompetensi (Team)</h3>
          <div class="grid">
            <div class="rating-row">
              <div class="label">Customer Fokus</div>
              <div class="controls"><select id="team_customer"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Driving Execution</div>
              <div class="controls"><select id="team_driving"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Developing Org Capabilities</div>
              <div class="controls"><select id="team_developing"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Managing Diversity</div>
              <div class="controls"><select id="team_diversity"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
          </div>
        </div>

        <!-- interview -->
        <div class="section">
          <h3>4. Hasil Wawancara</h3>
          <div class="grid">
            <div class="rating-row">
              <div class="label">Komunikasi</div>
              <div class="controls"><select id="interview_komunikasi"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Integritas / Etika</div>
              <div class="controls"><select id="interview_integritas"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Adaptif & Inisiatif</div>
              <div class="controls"><select id="interview_adaptif"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
            <div class="rating-row">
              <div class="label">Team Work</div>
              <div class="controls"><select id="interview_teamwork"><option value="">- Pilih -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
            </div>
          </div>
        </div>

        <!-- radar chart -->
        <div class="section" id="chartSection">
          <h3>Visualisasi Grafik Radar Kompetensi</h3>
          <canvas id="radarChart" width="400" height="400"></canvas>
        </div>

        <!-- catatan -->
        <div class="section">
          <h3>Kelebihan</h3>
          <textarea id="kelebihan" class="full"></textarea>
          <h3>Kekurangan</h3>
          <textarea id="kekurangan" class="full"></textarea>
        </div>

        <div class="buttons no-print">
          <button type="reset" class="btn secondary">Reset Form</button>
          <button type="button" class="btn success" onclick="downloadPDF()">Export PDF</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Chart.js, html2canvas, jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Foto upload
    const photoInput = document.getElementById('photoInput');
    const photoFrame = document.getElementById('photoFrame');
    photoFrame.addEventListener('click', ()=> photoInput.click());
    photoInput.addEventListener('change', e=>{
      const f = e.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      photoFrame.innerHTML = '<img src="'+url+'" alt="Foto Pelamar">';
    });
    function clearPhoto(){
      photoInput.value='';
      photoFrame.innerHTML='<span style="color:#99a0b3">Foto Pelamar<br/>(klik untuk pilih)</span>';
    }

    // Radar Chart
    const radarLabels = [
      "Customer Fokus (Personal)",
      "Driving Execution (Personal)",
      "Developing Org Cap (Personal)",
      "Managing Diversity (Personal)",
      "Customer Fokus (Team)",
      "Driving Execution (Team)",
      "Developing Org Cap (Team)",
      "Managing Diversity (Team)",
      "Komunikasi",
      "Integritas / Etika",
      "Adaptif & Inisiatif",
      "Team Work"
    ];
    const radarSelectIds = [
      "personal_customer","personal_driving","personal_developing","personal_diversity",
      "team_customer","team_driving","team_developing","team_diversity",
      "interview_komunikasi","interview_integritas","interview_adaptif","interview_teamwork"
    ];
    function getSelects(){ return radarSelectIds.map(id=>document.getElementById(id)); }
    const ctx=document.getElementById('radarChart').getContext('2d');
    const radarChart=new Chart(ctx,{
      type:'radar',
      data:{labels:radarLabels,datasets:[{label:'Nilai Assessment',data:new Array(radarLabels.length).fill(0),
        backgroundColor:'rgba(31,111,235,0.2)',borderColor:'rgba(31,111,235,1)',pointBackgroundColor:'rgba(31,111,235,1)'}]},
      options:{responsive:true,scales:{r:{min:0,max:5,ticks:{stepSize:1}}}}
    });
    function updateRadar(){
      const values=getSelects().map(sel=>parseInt(sel.value)||0);
      radarChart.data.datasets[0].data=values; radarChart.update();
    }
    getSelects().forEach(sel=> sel.addEventListener('change',updateRadar));

    // Export PDF → 2 halaman (form & chart)
    async function downloadPDF(){
      const { jsPDF } = window.jspdf;
      const card = document.getElementById("formCard");
      const chart = document.getElementById("chartSection");

      // Sembunyikan chart saat capture halaman 1
      chart.style.display = "none";
      const canvas1 = await html2canvas(card,{scale:2});
      chart.style.display = "block";

      const pdf = new jsPDF("p","mm","a4");
      const pageWidth = pdf.internal.pageSize.getWidth();

      // Halaman 1 (tanpa chart)
      const imgData1 = canvas1.toDataURL("image/png");
      const imgProps1 = pdf.getImageProperties(imgData1);
      const pdfHeight1 = (imgProps1.height * pageWidth) / imgProps1.width;
      pdf.addImage(imgData1,"PNG",0,0,pageWidth,pdfHeight1);

      // Halaman 2 (hanya chart)
      pdf.addPage();
      const canvas2 = await html2canvas(chart,{scale:2});
      const imgData2 = canvas2.toDataURL("image/png");
      const imgProps2 = pdf.getImageProperties(imgData2);
      const pdfHeight2 = (imgProps2.height * pageWidth) / imgProps2.width;
      pdf.addImage(imgData2,"PNG",0,20,pageWidth,pdfHeight2);

      pdf.save("Assessment_Manager.pdf");
    }
  </script>
</body>
</html>
